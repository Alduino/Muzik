stages:
  - build
  - test

linux-build:
    image: node
    stage: build
    before_script:
        - curl -f https://get.pnpm.io/v6.7.js | node - add --global pnpm@6
        - pnpm config set store-dir .pnpm-store
    script:
        - pnpm i
        - pnpm run r:build
    cache:
        key: "$CI_COMMIT_REF_SLUG"
        paths:
            - .pnpm-store
    rules:
        - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH

windows-build:
    stage: build
    script:
        - $ErrorActionPreference = "Stop"
        - choco install nodejs --yes --no-progress
        - (Invoke-WebRequest 'https://get.pnpm.io/v6.7.js' -UseBasicParsing).Content | node - add --global pnpm
        - pnpm i
        - pnpm run r:build
    tags:
        - windows

lint:
    image: ianwalter/pnpm
    stage: test
    script:
        - pnpm run lint
